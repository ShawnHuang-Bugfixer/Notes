# 策略模式
**策略模式**是一种行为设计模式， 它能让你定义一系列算法， 并将每种算法分别放入独立的类中， 以使算法的对象能够相互替换。

一句话总结“有种兵来将挡，水来土掩”，针对不同的场景采用不同的应对策略。客户端通过调用策略上下文方法设置策略并执行策略，策略上下文中包含策略接口，可以动态的调整策略并执行。

还要注意，策略模式的本质是可替换，即不同策略的入参（可以是对象）必须保持一致，如果不一致，说明不是一类问题，而策略模式强调针对不同情况适用不同策略解决一类问题。

![[attachments/Pasted image 20250902104752.png]]

## 计算不同场景下的优惠券折扣
计算优惠券折扣需要根据不同场景，使用不同的方式，比如满减卷、立减券和折扣卷等，完美符合策略模式。

策略上下文包含策略接口以及调用策略的方法，客户端使用时先掉根据具体场景设置计算策略，然后通过上下文直接调用即可。

```Java
@Data  
@AllArgsConstructor  
@NoArgsConstructor  
@Builder  
public class CouponCalculationStrategyContext {  
    private CouponCalculationStrategy couponCalculationStrategy;  
  
    public BigDecimal calculateDiscount(CouponTemplateDO template, BigDecimal orderAmount) {  
        return couponCalculationStrategy.calculateDiscount(template, orderAmount);  
    }  
}
```

策略接口仅仅提供一个标准的结算方法，等待具体计算类实现。

```Java
/**  
 * CouponCalculationStrategy 是一个用于计算优惠券折扣金额的策略接口。  
 * 各种类型的优惠券（如折扣券、满减券等）可以通过实现该接口来定义其具体的折扣计算逻辑。  
 *  
 */public interface CouponCalculationStrategy {  
  
    /**  
     * 计算折扣  
     *  
     * @param template    优惠券模板  
     * @param orderAmount 订单金额  
     * @return 优惠后金额  
     */  
    BigDecimal calculateDiscount(CouponTemplateDO template, BigDecimal orderAmount);  
}
```

具体的策略实现计算方法即可。

```Java
/**  
 * 该类用于计算有门槛固定金额优惠券的折扣金额。若满足门槛要求，该优惠券在结算时会直接减去固定的折扣金额  
 * 例如，如果优惠券的折扣金额为 50 元，门槛为100 元，满足门槛的订单 使用该优惠券后，订单金额会减少 50 元。  
 *  
 */public class ThresholdCalculationStrategy implements CouponCalculationStrategy {  
  
    @Override  
    public BigDecimal calculateDiscount(CouponTemplateDO template, BigDecimal orderAmount) {  
        ThresholdCouponDO thresholdDiscount = (ThresholdCouponDO) template;  
        if (orderAmount.compareTo(BigDecimal.valueOf(thresholdDiscount.getThresholdAmount())) >= 0) {  
            return BigDecimal.valueOf(thresholdDiscount.getDiscountAmount());  
        }  
        return BigDecimal.ZERO;  
    }  
}
```

![[attachments/策略模式.png]]