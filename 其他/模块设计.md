---
date: 2025-05-13
---
# `model1`

身份验证模块有三个迭代版本：

- `HttpSession` 单机 Session 方案。
- `satoken` + `redis` 分布式 Session 方案。
- `jwt` + `refreshToken` **双 token 认证**登录方案。

`JWT` 颁发后无法撤销，且服务端保持用户状态。单独使用 `JWT` 进行身份验证会带带来以下问题：

 - 用户无法注销登录，无法踢下线
 - 用户权限变更
 - `JWT` 较短的过期时间导致需要登录

为了解决这些问题，设计了 `jwt` + `refreshToken` 双 `token` 认证方案。在 Redis 中维护`jwt` 黑名单和 `refreshtoken`。`jwt` 黑名单存储异常的 `jwt`，`refreshtoken` 用于刷新 `jwt`。

完整的身份验证流程如下：

1. 客户端携带身份验证信息请求服务端
2. 服务端对身份信息进行校验，校验通过，服务端生成 `jwt` 和 `refreshtoken`，将 `refreshtoken` 存入 Redis，最后将 `refreshtoken` 和 `jwt` 返回给客户端。
3. 客户端携带 `jwt` 访问服务端，服务端对 `jwt` 进行校验，如果校验通过，放行；否则，进入刷新 `jwt` 流程。

`jwt` 刷新流程如下：

1. 客户端携带 `jwt` 访问服务端，服务端对 `jwt` 进行校验，`jwt` 未通过校验，服务端返回对应信息。
2. 客户端携带 `refreshtoken` 访问服务端刷新接口，服务端在 `redis` 中查找客户端携带的`refreshtoken`，查询结果不为空，生成新的 `refreshtoken` 和 `jwt` 并返回给客户端。









