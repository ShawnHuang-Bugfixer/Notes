# 核心模块

包含三个核心模块：
- 事件发布模块
- 消息队列
- 推送模块

## 事件监听模块

数据库维护用户表和消息表，多个消息对应一个用户。

定义消息事件接口，至少包含 userId，消息类型。

发布消息时，将消息先写入消息表，然后触发事件。

## 消息类型包含 3 种（只能为文本）

审核消息
活动消息
其他消息

事件监听模块根据消息类型动态创建对应的消息队列。

创建完毕后，将消息事件写入消息队列。

# 消息队列

消息队列为不同类型的消息创建消息队列。
等待被消费

# 消息推送模块

使用线程池从消息队列种消费消息。

根据消息类型分配不同处理器（暂时划分，执行逻辑完全一致，以后拓展时再修改不同的逻辑）：
- 审核消息处理器
- 活动消息处理器
- 其他消息处理器

消息处理器的逻辑：
	整合 WebSocket、 SSE、离线存储 实现消息推送。
	1. 检查 websocket 或者 / SSE 的连接状态，保持连接说明用户在线。
	2. 直接推送消息
	3. 浏览器返回确认信息，更改消息表中状态为已读。
	4. 用户不在线，当用户重新建立和服务器连接后，从表中拉取未读信息，整合后推送。