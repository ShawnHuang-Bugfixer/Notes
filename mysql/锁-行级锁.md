---
date: 2025-04-09
tags:
  - MySQL进阶
---
InnoDB 基于索引组织表数据[[Index-索引分类]]。**行级锁**基于索引项（B+ 树叶子节点）实现，并非基于记录实现。行锁主要分为三类：**行锁、间隙锁和临键锁**。

# 行级锁分类

1. **记录锁（Record Lock）**：锁定记录，支持的**隔离级别 RR，RC 。**
	![[attachments/Pasted image 20250409153628.png]]
2. **间隙锁（Gap Lock）**：锁定 B+ 树中升序叶子节点的索引值间隙（以聚集索引为例）。锁住间隙可以防止事务查询数据时其他事务插入数据导致出现`幻读`。支持的**隔离级别 RR**
	![[attachments/Pasted image 20250409154043.png]]
3. **临键锁（Next-Key Lock）**：组合 `行锁` 和`间隙锁`同时**锁某行和改行之前所有间隙**。
	![[attachments/Pasted image 20250409154612.png]]

## 记录锁（Record Lock）

记录锁分为两种类型：
1. 共享锁：确保读一致性。某记录的共享锁可以被多个事务同时持有，与排他锁互斥。
2. 排他锁：与 S 锁和 X锁互斥。允许更新内容。


