---
date: 2025-04-14
---
# 共享资源、临界区以及竟态条件

共享资源、临界区和竞态条件是操作系统中与并发控制相关的核心概念，以下是它们的详细解释及相互关系：

---

## ​**​1. 共享资源（Shared Resource）​**​

- ​**​定义​**​：多个进程或线程可以同时访问的资源（如内存、文件、硬件设备等）。
- ​**​问题​**​：并发访问可能导致数据不一致或逻辑错误。
- ​**​示例​**​：两个线程同时写入同一个全局变量。

---

## ​**​2. 临界区（Critical Section）​**​

- ​**​定义​**​：一段代码，用于访问共享资源，且在任意时刻​**​只能有一个线程/进程执行​**​。
- ​**​要求​**​：
    - ​**​互斥​**​：防止多个线程同时进入临界区。
    - ​**​进展​**​：若无线程在临界区，其他线程应能竞争进入。
    - ​**​有限等待​**​：线程等待进入临界区的时间必须是有限的（避免饥饿）。
- ​**​实现方式​**​：
    - ​**​锁（Mutex）​**​：线程进入前加锁，退出时解锁。
    - ​**​信号量（Semaphore）​**​：通过计数器控制访问权限。
    - ​**​原子操作​**​：硬件支持的不可中断操作（如CAS指令）。

---

## ​**​3. 竞态条件（Race Condition）​**​

- ​**​定义​**​：程序的行为因线程/进程的执行顺序不同而产生不可预测的结果。
- ​**​原因​**​：对共享资源的非原子操作（需多个步骤完成，期间可能被中断）。
- ​**​经典场景​**​：
    - ​**​未同步的计数器​**​：两个线程同时执行`count++`（实际包含读取、修改、写入三步）。
    - ​**​检查后行动（Check-then-Act）​**​：如懒加载单例模式中未加锁的判断。

竞态条件的解决思路可分为：

1. ​**​互斥访问​**​（加锁）
2. ​**​原子操作​**​（无锁）
3. ​**​避免共享​**​（无竞争）
4. ​**​事务性内存​**​（未来方向）

# 线程同步和线程互斥

**线程互斥** 确保同一时间​**​只有一个线程能访问共享资源​**​，防止并发修改导致数据不一致，可以利用加锁机制实现。

**线程同步** 的目的是**协调多个线程的执行顺序​**​，确保某些操作按预期顺序执行（如线程 A 等待线程 B 完成后再继续），**线程间通信**，通过等待通知机制实现。